<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Locations</title>

  <link rel="stylesheet" href="styles/layout.css" type="text/css">
  <link rel="stylesheet" href="styles/styles.css" type="text/css">
  <script src="./jquery-3.7.0.js"></script>
  <script src="script.js"></script>
  <script>

    $(function () {
      $("#includedContent").load("./partials/head.html");
    });
    $(function () {
      $("#includedFooter").load("./partials/footer.html");
    });


    async function checkToken() {

      let cookie = document.cookie;
      cookie = cookie.split(";");
      cookie = cookie.find((element) => {
        return element.includes("JWebToken");
      })
      if (cookie != undefined) {
        let token = cookie.split("=")[1];
        let req = await fetch("/api/token", {
          method: "POST",
          headers: {
            'Content-Type': 'application/json'
          }
          , body: JSON.stringify({token: token})
        })
        let res = await req.text();
        if (res === "logged") {
          admin = true;
        } else {
          console.log("not logged");
          alert("Cookie expired, please log in");
        }
      }
    }


    function init() {
      checkToken();
    }


  </script>
</head>
<body>


<div id="includedContent">
</div>


<div class="wrapper col3">
  <div id="container">


    <div>
      <h1> Locations </h1>
      <table id="locations_table">
        <tr>
          <th>Location name</th>
          <th>Location city</th>
          <th>Location category</th>
        </tr>
      </table>
    </div>
  </div>
  <script>
    init();
    async function getLocationList() {
      let req = await fetch("/api/getLocationslist", {
        method: "GET",
        headers: {
          'Content-Type': 'application/json'
        }
      })

      let res = await req.json();
      let table = document.getElementById("locations_table");
      for (let i = 0; i < res.length; i++) {
        let row = table.insertRow(i + 1);
        let cell1 = row.insertCell(0);
        let cell2 = row.insertCell(1);
        let cell3 = row.insertCell(2);

        cell1.innerHTML = res[i].nomSite;
        cell2.innerHTML = res[i].villeSite;
        cell3.innerHTML = res[i].categorieSite;
      }
    }


  </script>
</div>

<div id="includedFooter"></div>



</body>
</html>